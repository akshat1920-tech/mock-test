<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Mock Test</title>
<style>
  body { margin: 0; font-family: Arial, sans-serif; height: 100vh; display: flex; }

  /* Left Part */
  .left { width: 75%; background-color: #e6f7ff; display: flex; flex-direction: column; padding: 10px; box-sizing: border-box; }
  .lbox { margin-bottom: 10px; display: flex; align-items: center; justify-content: space-between; border: 1px solid #999; background-color: #ffffff; box-sizing: border-box; padding: 0 10px; }
  .lbox1 { height: 6.4%; }
  .lbox2 { height: 7.2%; }
  .lbox-container { flex-grow: 1; display: flex; flex-direction: column; }
  .lbox3 { flex: 9; display: flex; flex-direction: column; justify-content: flex-start; align-items: flex-start; padding: 10px; overflow-y: auto; }
  .lbox4 { flex: 1; display: flex; justify-content: space-between; align-items: center; padding: 5px 10px; }
  .lbox4 button, .submit-button { padding: 5px 10px; border: none; background-color: #d3d3d3; cursor: pointer; font-size: 14px; border-radius: 4px; transition: transform 0.2s ease; }
  .lbox4 .left-buttons { display: flex; align-items: center; }
  .lbox4 .left-buttons button { margin-right: 5px; }
  .submit-button { width: 80%; margin: 0 auto; display: block; }

  /* Timer */
  .timer { font-weight: bold; color: #000; }

  /* Right Part */
  .right { width: 25%; background-color: #e6f7ff; display: flex; flex-direction: column; padding: 10px; box-sizing: border-box; }
  .rbox { margin-bottom: 10px; display: flex; align-items: center; justify-content: flex-start; border: 1px solid #999; background-color: #ffffff; box-sizing: border-box; padding: 5px; flex-direction: column; }
  .box1 { height: 15%; background-color: #cce5ff; flex-direction: row; display: flex; align-items: center; justify-content: center; }  
  .box2 { height: 15%; }  
  .box3 { height: 5%; }  
  .box4 { flex-grow: 1; display: flex; flex-direction: column; align-items: flex-start; padding: 10px; overflow-y: auto; }
  .box5 { height: 15%; display: flex; justify-content: center; align-items: center; }

  .rbox.box1 img { width: 100%; height: 100%; object-fit: contain; }

  /* Question palette */
  .question-palette { display: flex; flex-wrap: wrap; gap: 5px; justify-content: flex-start; width: 100%; }
  .question-wrapper { width: 20%; aspect-ratio: 1/1; border: 1px solid black; box-sizing: border-box; margin: 2px; }
  .question-wrapper button { width: 100%; height: 100%; border: none; background-color: #d3d3d3; font-size: 14px; cursor: pointer; }
  .question-wrapper.active button { border: 2px solid #000; }

  /* MCQ options */
  .options label { display: block; margin: 5px 0; cursor: pointer; }
</style>
</head>
<body>
  <!-- Left side -->
  <div class="left">
    <div class="lbox lbox1">
      <div>Mock Test</div>
      <div class="timer" id="timer">20:00</div>
    </div>
    <div class="lbox lbox2">Instructions: Select the correct option and navigate through the test.</div>
    <div class="lbox-container">
      <div class="lbox lbox3" id="questionDisplay"></div>
      <div class="lbox lbox4">
        <div class="left-buttons">
          <button onclick="previousQuestion()">Previous</button>
          <button onclick="markForReview()">Mark for Review</button>
          <button onclick="clearAnswer()">Clear</button>
        </div>
        <div class="right-button">
          <button onclick="saveAndNext()">Save & Next</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Right side -->
  <div class="right">
    <div class="rbox box1">
      <img src="myimage.png" alt="Logo">
      Login
    </div>
    <div class="rbox box2">Test Info</div>
    <div class="rbox box3">Time Left</div>
    <div class="rbox box4">
      <div class="question-palette" id="questionPalette"></div>
    </div>
    <div class="rbox box5">
      <button class="submit-button" onclick="submitTest()">Submit</button>
    </div>
  </div>

<script>
let questions = [];
let currentQuestion = 0;
const display = document.getElementById('questionDisplay');
const palette = document.getElementById('questionPalette');
const timerDisplay = document.getElementById('timer');
let timeLeft = 20*60; // 20 min countdown

// --- Dynamically determine JSON file from HTML filename ---
const htmlFile = location.pathname.split('/').pop(); // e.g., ga-test1.html
const jsonFile = htmlFile.replace('.html', '.json'); // e.g., ga-test1.json

fetch(jsonFile)
  .then(res => res.json())
  .then(data => {
    questions = data.map(q => ({ ...q, selected: null, status: 'notVisited' }));
    createPaletteButtons();
    showQuestion(0);
  })
  .catch(err => alert('Failed to load questions: '+err));

// Timer
function updateTimer(){
  let min = Math.floor(timeLeft/60);
  let sec = timeLeft%60;
  timerDisplay.innerText = `${min.toString().padStart(2,'0')}:${sec.toString().padStart(2,'0')}`;
  if(timeLeft>0){ timeLeft--; } else { clearInterval(timerInterval); alert("Time's up!"); submitTest(); }
}
const timerInterval = setInterval(updateTimer,1000);

// Display question
function showQuestion(index){
  currentQuestion = index;
  const q = questions[index];
  if(q.status==='notVisited') q.status='visited';
  updatePalette();
  display.innerHTML = `<h3>${q.text}</h3><div class="options">` +
    q.options.map((opt,i)=>{
      const checked = q.selected===i?'checked':'';
      return `<label><input type="radio" name="q${index}" value="${i}" ${checked}> ${opt}</label>`;
    }).join('') + `</div>`;
}

// Palette buttons
function createPaletteButtons(){
  palette.innerHTML = '';
  questions.forEach((q,i)=>{
    const wrapper = document.createElement('div');
    wrapper.className = 'question-wrapper';
    const btn = document.createElement('button');
    btn.innerText = i+1;
    btn.onclick = ()=>{ saveSelected(); showQuestion(i); };
    wrapper.appendChild(btn);
    palette.appendChild(wrapper);
  });
  updatePalette();
}

// Update palette colors
function updatePalette(){
  const wrappers = palette.querySelectorAll('.question-wrapper');
  wrappers.forEach((w,i)=>{
    w.querySelector('button').style.backgroundColor = {
      notVisited:'#d3d3d3',
      visited:'#FFA500',
      answered:'#32CD32',
      review:'#800080'
    }[questions[i].status];
    w.classList.remove('active');
  });
  wrappers[currentQuestion].classList.add('active');
}

// Save selected answer
function saveSelected(){
  const q = questions[currentQuestion];
  const sel = display.querySelector('input[type="radio"]:checked');
  if(sel){ q.selected = parseInt(sel.value); q.status='answered'; } 
  else if(q.status!=='review'){ q.status='visited'; }
  updatePalette();
}

// Navigation & actions
function saveAndNext(){ saveSelected(); currentQuestion=(currentQuestion+1)%questions.length; showQuestion(currentQuestion); }
function previousQuestion(){ saveSelected(); currentQuestion=(currentQuestion-1+questions.length)%questions.length; showQuestion(currentQuestion); }
function markForReview(){ questions[currentQuestion].status='review'; updatePalette(); }
function clearAnswer(){ const q=questions[currentQuestion]; q.selected=null; if(q.status==='answered') q.status='visited'; display.querySelectorAll('input[type="radio"]').forEach(r=>r.checked=false); updatePalette(); }
function submitTest(){ saveSelected(); alert("Test submitted!"); console.log("User Answers:", questions); }
</script>
</body>
</html>
